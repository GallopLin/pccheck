# å®éªŒæ–‡ä»¶æ¸…å•

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
experiments/
â”œâ”€â”€ README.md                      # è¯¦ç»†å®éªŒé…ç½®è¯´æ˜
â”œâ”€â”€ EXPERIMENT_GUIDE.md            # å®éªŒå¿«é€ŸæŒ‡å—ï¼ˆæ¨èé˜…è¯»ï¼‰
â”œâ”€â”€ benchmark_comparison.py        # ä¸»å®éªŒè„šæœ¬ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ quick_test.py                  # å¿«é€ŸéªŒè¯è„šæœ¬ï¼ˆ2-3åˆ†é’Ÿï¼‰
â”œâ”€â”€ generate_report.py             # æŠ¥å‘Šç”Ÿæˆå™¨
â”œâ”€â”€ visualize_results.py           # ç»“æœå¯è§†åŒ–
â”œâ”€â”€ run_benchmark.sh               # å®Œæ•´å®éªŒè¿è¡Œè„šæœ¬ï¼ˆ30-60åˆ†é’Ÿï¼‰
â”œâ”€â”€ start.sh                       # äº¤äº’å¼å¯åŠ¨è„šæœ¬
â””â”€â”€ FILES.md                       # æœ¬æ–‡ä»¶
```

## ğŸ“‹ æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒè„šæœ¬

#### 1. `benchmark_comparison.py` â­â­â­â­â­
**æœ€é‡è¦çš„æ–‡ä»¶**

- **åŠŸèƒ½**: å¯¹æ¯”ä¸‰ç§æ£€æŸ¥ç‚¹æ–¹æ³•çš„æ€§èƒ½
  - ä¼ ç»Ÿ PyTorch (`torch.save`)
  - åŸå§‹ PCCheck
  - æ”¹è¿›çš„åˆ†å±‚ PCCheck
  
- **è¾“å‡º**: 
  - æ§åˆ¶å°æ€§èƒ½æ‘˜è¦
  - JSON æ ¼å¼çš„è¯¦ç»†ç»“æœ
  
- **ä½¿ç”¨æ–¹å¼**:
  ```bash
  python benchmark_comparison.py \
      --d-model 512 \
      --num-layers 6 \
      --num-steps 100 \
      --methods traditional original layerwise
  ```

- **å…³é”®å‚æ•°**:
  - `--d-model`: æ¨¡å‹ç»´åº¦
  - `--num-layers`: Transformer å±‚æ•°
  - `--num-steps`: è®­ç»ƒæ­¥æ•°
  - `--checkpoint-freq`: æ£€æŸ¥ç‚¹ä¿å­˜é¢‘ç‡
  - `--num-threads`: PCCheck çº¿ç¨‹æ•°
  - `--max-async`: æœ€å¤§å¹¶å‘æ£€æŸ¥ç‚¹æ•°

#### 2. `quick_test.py` â­â­â­â­
**æ¨èé¦–å…ˆè¿è¡Œ**

- **åŠŸèƒ½**: å¿«é€ŸéªŒè¯ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
- **æ—¶é—´**: 2-3 åˆ†é’Ÿ
- **è¾“å‡º**: ç®€å•çš„æ€§èƒ½å¯¹æ¯”
  
- **ä½¿ç”¨æ–¹å¼**:
  ```bash
  python quick_test.py
  ```

- **é€‚ç”¨åœºæ™¯**:
  - é¦–æ¬¡è¿è¡Œï¼ŒéªŒè¯ç¯å¢ƒ
  - å¿«é€Ÿæ£€æŸ¥æ”¹åŠ¨æ˜¯å¦ç”Ÿæ•ˆ
  - æ¼”ç¤ºåŸºæœ¬æ•ˆæœ

### è‡ªåŠ¨åŒ–è„šæœ¬

#### 3. `run_benchmark.sh` â­â­â­â­â­
**å®Œæ•´å®éªŒå¥—ä»¶**

- **åŠŸèƒ½**: è‡ªåŠ¨è¿è¡Œå…¨éƒ¨å®éªŒ
  - 5 ç»„ä¸åŒé…ç½®çš„å®éªŒ
  - è‡ªåŠ¨ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
  
- **æ—¶é—´**: 30-60 åˆ†é’Ÿ
  
- **ä½¿ç”¨æ–¹å¼**:
  ```bash
  ./run_benchmark.sh
  ```

- **å®éªŒå†…å®¹**:
  1. å°å‹æ¨¡å‹æµ‹è¯•
  2. ä¸­å‹æ¨¡å‹æµ‹è¯•
  3. å¤§å‹æ¨¡å‹æµ‹è¯•
  4. ä¸åŒæ£€æŸ¥ç‚¹é¢‘ç‡å¯¹æ¯”
  5. Monitor æ¨¡å¼å¯¹æ¯”

#### 4. `start.sh` â­â­â­
**äº¤äº’å¼å¯åŠ¨**

- **åŠŸèƒ½**: æä¾›å‹å¥½çš„äº¤äº’ç•Œé¢
  - é€‰æ‹©æµ‹è¯•ç±»å‹
  - è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒ
  - ç¼–è¯‘ PCCheck åº“ï¼ˆå¦‚éœ€è¦ï¼‰
  
- **ä½¿ç”¨æ–¹å¼**:
  ```bash
  ./start.sh
  # ç„¶åæ ¹æ®æç¤ºé€‰æ‹©é€‰é¡¹
  ```

### ç»“æœå¤„ç†

#### 5. `generate_report.py` â­â­â­â­
**æŠ¥å‘Šç”Ÿæˆå™¨**

- **åŠŸèƒ½**: ä»å®éªŒç»“æœç”Ÿæˆ Markdown æŠ¥å‘Š
  - æ±‡æ€»è¡¨æ ¼
  - è¯¦ç»†åˆ†æ
  - ç»“è®ºå»ºè®®
  
- **ä½¿ç”¨æ–¹å¼**:
  ```bash
  python generate_report.py \
      --input-dir ./benchmark_results \
      --output-file ./report.md
  ```

- **è¾“å‡ºç¤ºä¾‹**:
  ```markdown
  # PCCheck æ”¹è¿›æ•ˆæœå®éªŒæŠ¥å‘Š
  
  ## æ ¸å¿ƒå‘ç°
  - å¹³å‡åŠ é€Ÿæ¯”: 2.34x
  - æ£€æŸ¥ç‚¹å¼€é”€é™ä½: 65%
  
  ## è¯¦ç»†æ•°æ®
  [è¡¨æ ¼...]
  ```

#### 6. `visualize_results.py` â­â­â­
**å¯è§†åŒ–å·¥å…·**

- **åŠŸèƒ½**: ç”Ÿæˆæ€§èƒ½å¯¹æ¯”å›¾è¡¨
  - ååé‡å¯¹æ¯”
  - æ£€æŸ¥ç‚¹å¼€é”€
  - åŠ é€Ÿæ¯”
  - ä¿å­˜æ—¶é—´
  - å†…å­˜ä½¿ç”¨
  
- **ä¾èµ–**: `matplotlib`
  
- **ä½¿ç”¨æ–¹å¼**:
  ```bash
  pip install matplotlib  # å¦‚æœæœªå®‰è£…
  python visualize_results.py \
      --input-dir ./benchmark_results
  ```

- **è¾“å‡º**: PNG æ ¼å¼å›¾è¡¨

### æ–‡æ¡£

#### 7. `README.md` â­â­â­â­
**è¯¦ç»†é…ç½®è¯´æ˜**

- æ‰€æœ‰å‚æ•°çš„è¯¦ç»†è¯´æ˜
- å®éªŒåœºæ™¯é…ç½®
- æ•…éšœæ’é™¤æŒ‡å—

#### 8. `EXPERIMENT_GUIDE.md` â­â­â­â­â­
**å¿«é€Ÿå…¥é—¨æŒ‡å—**

- æ”¹è¿›è¦ç‚¹æ€»ç»“
- å¿«é€Ÿå¼€å§‹æ­¥éª¤
- é¢„æœŸç»“æœè¯´æ˜

## ğŸš€ æ¨èä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ¬¡è¿è¡Œ

```bash
# 1. å¿«é€ŸéªŒè¯ï¼ˆ2-3åˆ†é’Ÿï¼‰
cd /home/linzhicheng/code/pccheck/checkpoint_eval/experiments
python quick_test.py

# 2. å¦‚æœéªŒè¯é€šè¿‡ï¼Œè¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆ30-60åˆ†é’Ÿï¼‰
./run_benchmark.sh

# 3. æŸ¥çœ‹æŠ¥å‘Š
cat benchmark_results_*/summary_report.md

# 4. ç”Ÿæˆå›¾è¡¨ï¼ˆå¯é€‰ï¼‰
python visualize_results.py --input-dir benchmark_results_*
```

### è‡ªå®šä¹‰å®éªŒ

```bash
# å•ç‹¬æµ‹è¯•ç‰¹å®šé…ç½®
python benchmark_comparison.py \
    --d-model 1024 \
    --num-layers 12 \
    --num-steps 200 \
    --checkpoint-freq 20 \
    --num-threads 16 \
    --methods layerwise
```

### äº¤äº’å¼è¿è¡Œ

```bash
# ä½¿ç”¨äº¤äº’å¼è„šæœ¬
./start.sh
```

## ğŸ“Š è¾“å‡ºæ–‡ä»¶

### å®éªŒç»“æœ

```
benchmark_results_YYYYMMDD_HHMMSS/
â”œâ”€â”€ summary_report.md              # æ±‡æ€»æŠ¥å‘Š
â”œâ”€â”€ small_model/
â”‚   â””â”€â”€ comparison_*.json          # å°å‹æ¨¡å‹ç»“æœ
â”œâ”€â”€ medium_model/
â”‚   â””â”€â”€ comparison_*.json          # ä¸­å‹æ¨¡å‹ç»“æœ
â”œâ”€â”€ large_model/
â”‚   â””â”€â”€ comparison_*.json          # å¤§å‹æ¨¡å‹ç»“æœ
â”œâ”€â”€ freq_test/
â”‚   â”œâ”€â”€ freq_5/
â”‚   â”œâ”€â”€ freq_10/
â”‚   â”œâ”€â”€ freq_20/
â”‚   â””â”€â”€ freq_50/
â””â”€â”€ monitor_test/
    â”œâ”€â”€ direct/
    â””â”€â”€ monitor/
```

### å›¾è¡¨æ–‡ä»¶ï¼ˆå¦‚æœç”Ÿæˆï¼‰

```
benchmark_results_*/plots/
â”œâ”€â”€ throughput_comparison.png      # ååé‡å¯¹æ¯”
â”œâ”€â”€ checkpoint_overhead.png        # æ£€æŸ¥ç‚¹å¼€é”€
â”œâ”€â”€ speedup_comparison.png         # åŠ é€Ÿæ¯”
â”œâ”€â”€ checkpoint_time.png            # ä¿å­˜æ—¶é—´
â””â”€â”€ memory_usage.png               # å†…å­˜ä½¿ç”¨
```

## ğŸ”§ è‡ªå®šä¹‰å’Œæ‰©å±•

### æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯

åœ¨ `run_benchmark.sh` ä¸­æ·»åŠ ï¼š

```bash
echo "æ–°å®éªŒ"
python benchmark_comparison.py \
    [your custom parameters] \
    --output-dir $OUTPUT_DIR/custom_test
```

### ä¿®æ”¹æŠ¥å‘Šæ ¼å¼

ç¼–è¾‘ `generate_report.py` ä¸­çš„è¡¨æ ¼ç”Ÿæˆå‡½æ•°ã€‚

### æ·»åŠ æ–°çš„å¯è§†åŒ–

åœ¨ `visualize_results.py` ä¸­æ·»åŠ æ–°çš„ç»˜å›¾å‡½æ•°ã€‚

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡è¿è¡Œå‰**:
   - âœ… ç¡®ä¿ PCCheck åº“å·²ç¼–è¯‘
   - âœ… è®¾ç½® PYTHONPATH
   - âœ… æ£€æŸ¥ CUDA å¯ç”¨æ€§

2. **è¿è¡Œè¿‡ç¨‹ä¸­**:
   - â±ï¸ å®Œæ•´æµ‹è¯•éœ€è¦è¾ƒé•¿æ—¶é—´
   - ğŸ’¾ ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
   - ğŸ–¥ï¸ å»ºè®®åœ¨ GPU ä¸Šè¿è¡Œ

3. **ç»“æœåˆ†æ**:
   - ğŸ“Š å…³æ³¨åŠ é€Ÿæ¯”å’Œå¼€é”€é™ä½
   - ğŸ” æ£€æŸ¥ä¸åŒé…ç½®ä¸‹çš„è¡¨ç°
   - ğŸ“ˆ ä½¿ç”¨å¯è§†åŒ–å¸®åŠ©ç†è§£

## ğŸ†˜ è·å–å¸®åŠ©

```bash
# æŸ¥çœ‹è„šæœ¬å¸®åŠ©
python benchmark_comparison.py --help
python generate_report.py --help
python visualize_results.py --help

# æŸ¥çœ‹æ–‡æ¡£
cat README.md
cat EXPERIMENT_GUIDE.md
```

---

**æ–‡ä»¶æ¸…å•æœ€åæ›´æ–°**: 2025-10-27
